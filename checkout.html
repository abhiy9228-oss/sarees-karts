<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Checkout</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<header>
    <h1>Checkout</h1>
    <nav>
        <a href="cart.html">‚Üê Back to Cart</a>
    </nav>
</header>

<section style="padding:20px;max-width:600px;margin:auto;">

<!-- ORDER SUMMARY -->
<div id="checkout-items"></div>
<h2>Total Amount: ‚Çπ<span id="checkout-total">0</span></h2>

<hr>

<!-- DELIVERY DETAILS -->
<h3>Delivery Details</h3>

<input id="cust-name" placeholder="Full Name"
style="width:100%;padding:10px;margin:6px 0;">

<input id="cust-mobile" placeholder="Mobile Number"
style="width:100%;padding:10px;margin:6px 0;">

<textarea id="cust-address" placeholder="Delivery Address"
style="width:100%;padding:10px;margin:6px 0;"></textarea>

<button id="confirm-details-btn"
style="background:#2196F3;color:white;padding:10px 15px;border:none;border-radius:5px;">
Done
</button>

<p id="details-msg" style="color:red;display:none;margin-top:8px;">
Please fill delivery details and click DONE
</p>

<hr>

<!-- PAYMENT OPTIONS -->
<h3>Select Payment Method</h3>

<div class="payment-radio disabled" onclick="selectPayment('online')">
<input type="radio" disabled> üí≥ Online Payment
</div>

<div class="payment-radio disabled" onclick="selectPayment('cod')">
<input type="radio" disabled> üöö Cash on Delivery
</div>

<!-- ONLINE PAYMENT -->
<div id="online-section" style="display:none;margin-top:15px;">
<p><b>UPI:</b> 9876543210@upi</p>
<img src="images/upi-qr.png" width="200"><br><br>
<button onclick="confirmOrder('Online Payment')"
style="background:#4CAF50;color:white;padding:10px;border:none;border-radius:5px;">
I Have Paid
</button>
</div>

<!-- COD -->
<div id="cod-section" style="display:none;margin-top:15px;">
<button id="cod-confirm-btn"
style="background:#e91e63;color:white;padding:10px;border:none;border-radius:5px;">
Confirm Order
</button>
</div>

</section>

<script>
let cart = JSON.parse(localStorage.getItem("cart")) || [];
let detailsConfirmed = false;

/* SHOW CART */
let total = 0;
const box = document.getElementById("checkout-items");

cart.forEach(item => {
    box.innerHTML += `
    <div style="display:flex;align-items:center;margin-bottom:10px;">
        <img src="${item.image}" width="60"
        style="margin-right:10px;border-radius:5px">
        <div>${item.name}<br>‚Çπ${item.price}</div>
    </div>`;
    total += Number(item.price);
});

document.getElementById("checkout-total").innerText = total;

/* CONFIRM DELIVERY DETAILS */
document.getElementById("confirm-details-btn").onclick = () => {

    const name = custName.value.trim();
    const mobile = custMobile.value.trim();
    const address = custAddress.value.trim();

    if (!name || !mobile || !address) {
        document.getElementById("details-msg").style.display = "block";
        return;
    }

    if (mobile.length !== 10 || isNaN(mobile)) {
        alert("Enter valid 10-digit mobile number");
        return;
    }

    detailsConfirmed = true;

    document.querySelectorAll(".payment-radio").forEach(p => {
        p.classList.remove("disabled");
        p.querySelector("input").disabled = false;
    });

    document.getElementById("details-msg").style.display = "none";
};

/* PAYMENT SELECTION */
function selectPayment(type) {

    if (!detailsConfirmed) {
        document.getElementById("details-msg").style.display = "block";
        return;
    }

    document.getElementById("online-section").style.display =
        type === "online" ? "block" : "none";

    document.getElementById("cod-section").style.display =
        type === "cod" ? "block" : "none";
}

/* CONFIRM ORDER (ONLINE + COD) */
function confirmOrder(paymentMode) {

    if (!detailsConfirmed) {
        alert("Confirm delivery details first");
        return;
    }

    const name = custName.value.trim();
    const mobile = custMobile.value.trim();
    const address = custAddress.value.trim();

    if (!name || !mobile || !address || cart.length === 0) {
        alert("Invalid order details");
        return;
    }

    const orderId = "ORD" + Math.floor(100000 + Math.random()*900000);
    const otp = Math.floor(100000 + Math.random()*900000);

    let msg = "üõçÔ∏è New Saree Order\n\n";
    msg += `üë§ Name: ${name}%0A`;
    msg += `üìû Mobile: ${mobile}%0A`;
    msg += `üè† Address: ${address}%0A%0A`;

    let sum = 0;
    cart.forEach(i => {
        msg += `‚Ä¢ ${i.name} ‚Äì ‚Çπ${i.price}%0A`;
        msg += `${i.image}%0A%0A`;
        sum += Number(i.price);
    });

    msg += `üí∞ Total: ‚Çπ${sum}%0A`;
    msg += `üí≥ Payment: ${paymentMode}%0A`;
    msg += `üÜî Order ID: ${orderId}%0A`;
    msg += `üîê Delivery OTP: ${otp}%0A%0A`;
    msg += `üîë Admin Dashboard:%0A`;
    msg += `https://abhiy9228-oss.github.io/sareekart/admin-dashboard.html`;

    window.open(`https://wa.me/918019973283?text=${msg}`, "_blank");

    localStorage.removeItem("cart");

    setTimeout(() => {
        window.location.href = "my-orders.html";
    }, 800);
}

/* FORCE COD BUTTON CLICK */
document.getElementById("cod-confirm-btn").onclick = () => {
    confirmOrder("Cash on Delivery");
};

/* INPUT REFERENCES */
const custName = document.getElementById("cust-name");
const custMobile = document.getElementById("cust-mobile");
const custAddress = document.getElementById("cust-address");
</script>

</body>
</html>
